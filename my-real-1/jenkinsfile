pipeline{
    agent any
    parameters {
        string(name: 'BRANCH', defaultValue: 'master', description: 'Branch to build from')
        string(name: 'PORT', defaultValue: '5000', description: 'port to expose the application')
        string(name: 'CONTAINER_NAME', defaultValue: 'my-real-1-container', description: 'Name of the container')
    }
    environment {
        DOCKER_IMAGE = "my-real-1-image:latest"
    }
    stages {
        stage('Checkout') {
            steps {
                git branch: "${params.BRANCH}",
                url: "https://github.com/Siddha200340/my-real-1-app.git"
            }
        }
        stage('Build') {
            steps {
                bat "docker build -t %DOCKER_IMAGE% ."
            }
        }
        stage('Run') {
            steps {
                bat "docker rm -f ${params.CONTAINER_NAME} || exit 0"
                bat "docker run -d -p ${params.PORT}:5000 --name ${params.CONTAINER_NAME} %DOCKER_IMAGE%"
            }
        }
    }
}